---
import instagram from "../assets/instagram.svg";
import PaymentModal from "../components/modals/payment-modal.astro";
import SelectFollowersInstagram from "../components/modals/select-followers-instagram.astro";
---

<!-- Hero Section -->
<section id="inicio" class="relative overflow-hidden">
    <div class="relative container mx-auto px-6 py-20 text-center">
        <div class="max-w-4xl mx-auto">
            <!-- Main Headline -->
            <h1 class="text-5xl md:text-7xl font-black text-white mb-6 leading-tight">
                Impulsa tu visibilidad en <span class="gradient-text-insta">Instagram</span>
                <br />
            </h1>
            <!-- Subheadline -->
            <p class="text-lg md:text-xl text-gray-300 mb-8 max-w-3xl mx-auto leading-relaxed">
                ðŸ”¥ <strong class="text-yellow-400">Cero bots. Cero cuentas inventadas.</strong> Solo visibilidad
                verdadera a travÃ©s de nuestra red confiable de
                socios, siguiendo todas las reglas de la plataforma.
            </p>

            <!-- Hero Input Section -->
            <div class="max-w-2xl mx-auto mb-8">
                <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-6 border border-white/30">
                    <form id="heroForm" class="flex flex-col sm:flex-row gap-4">
                        <div class="flex-1 relative">
                            <input maxlength="20" type="text" autocomplete="off" id="usernameInput" name="usernameInput"
                                placeholder="@ingresa usuario instagram"
                                class="w-full px-6 py-4 text-lg bg-white20 border border-white/30 rounded-xl text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300"
                                required />
                            <div class="absolute right-3 top-1/2 transform -translate-y-1/2">
                                <img src={instagram.src} alt="logo instagram" />
                            </div>
                        </div>

                        <button type="submit"
                            class="px-8 py-4 bg-gradient-to-tl from-blue-600/80 via-blue-500 to-blue-600/80 text-white font-bold text-lg rounded-xl hover:scale-105 transform transition-all duration-300 shadow-2xl flex items-center justify-center space-x-2 whitespace-nowrap">
                            <span>Continuar</span>
                            <span>â†’</span>
                        </button>
                    </form>

                    <p id="message-error" class="hidden text-red-300 text-sm px-4 py-1 border-red-600 border bg-red-400/30 w-fit m-auto my-4 rounded-4xl"></p>
                    <div class="flex items-center justify-center space-x-6 mt-4 text-sm text-gray-300">
                        <div class="flex items-center space-x-1">
                            <span class="text-green-400">âœ“</span>
                            <span>Seguro y privado</span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <span class="text-green-400">âœ“</span>
                            <span>Sin Bots</span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <span class="text-green-400">âœ“</span>
                            <span>Resultados Reales</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stats -->
            <div class="flex flex-wrap justify-center gap-8 mb-8">
                <div class="text-center">
                    <div class="text-3xl md:text-4xl font-bold text-yellow-400">
                        +4.5k
                    </div>
                    <div class="text-gray-300">CampaÃ±as vendidas</div>
                </div>
                <div class="text-center">
                    <div class="text-3xl md:text-4xl font-bold text-green-400">
                        98%
                    </div>
                    <div class="text-gray-300">SatisfacciÃ³n</div>
                </div>
                <div class="text-center">
                    <div class="text-3xl md:text-4xl font-bold text-blue-400">
                        +3.2k
                    </div>
                    <div class="text-gray-300">Videos virales</div>
                </div>
            </div>
            <!-- CTA Button -->
            <div class="space-y-2">
                <p class="text-sm text-gray-400">
                    âš¡ Mejora tu presencia en redes sociales
                </p>
            </div>
        </div>
    </div>
</section>

<SelectFollowersInstagram />

<PaymentModal />

<div id="loaderModal"
    class="hidden opacity-0 fixed inset-0 z-[70] flex items-center justify-center bg-black/70 backdrop-blur-sm transition-opacity duration-200"
    role="dialog" aria-modal="true" aria-labelledby="loaderTitle">
    <div class="mx-4 w-full max-w-sm rounded-2xl border border-white/20 bg-white/10 p-6 text-center shadow-xl">
        <div class="mx-auto mb-4 h-12 w-12 rounded-full border-4 border-blue-400/40 border-t-transparent animate-spin">
        </div>
        <h2 id="loaderTitle" class="text-white text-lg font-semibold mb-1">
            Procesando
        </h2>
        <p data-loader-text class="text-gray-200 text-sm">
            Por favor, espera un momento... <br />
            <span class="pt-3">No recargues la ventana</span>
        </p>
    </div>
</div>

<!-- Hero Form -->
<script is:inline>
    // Hero input Submit
    document .getElementById("heroForm").addEventListener("submit", function (e) {
            e.preventDefault();
            openModal();
        });

    // Auto-add @ symbol to input
    document .getElementById("usernameInput").addEventListener("input", function (e) {
            let value = e.target.value;

            // If the input is empty or doesn't start with @, add it
            if (value.length === 0 || !value.startsWith("@")) {
                // If user typed something but no @, add @ at the beginning
                if (value.length > 0 && !value.startsWith("@")) {
                    e.target.value = "@" + value;
                }
                // If input is empty and user starts typing, add @
                else if (value.length === 0) {
                    e.target.value = "@";
                }
            }

            // Prevent user from deleting the @ symbol
            if (value.length > 0 && !value.startsWith("@")) {
                e.target.value = "@" + value.replace("@", "");
            }
        });

    document.getElementById("usernameInput").addEventListener("keydown", function (e) {
        const input = e.target;
        const cursorPosition = input.selectionStart;

        // Evitar borrar el @ inicial
        if ((e.key === "Backspace" || e.key === "Delete") && cursorPosition <= 1) {
            e.preventDefault();
            // Mantener cursor despuÃ©s de @
            setTimeout(() => {
                input.setSelectionRange(1, 1);
            }, 0);
        }

        // Evitar espacios
        if (e.key === " " || e.code === "Space") {
            e.preventDefault();
        }
    });

    // Adicionalmente, eliminar cualquier espacio que se haya pegado
    document.getElementById("usernameInput").addEventListener("input", function (e) {
        const input = e.target;
        input.value = input.value.replace(/\s+/g, "");
    });

    // Set initial @ when input gets focus
    document.getElementById("usernameInput").addEventListener("focus", function (e) {
            if (e.target.value === "") {
                e.target.value = "@";
                // Position cursor after @
                setTimeout(() => {
                    e.target.setSelectionRange(1, 1);
                }, 0);
            }
    });

    function openModal() {
        const error = document.getElementById('message-error');
        const username = document.getElementById('usernameInput').value.trim();
        
        if (!username || username === '@') {
            error.classList.remove("hidden")
            error.innerText = "Debe ingresar usuario de instagram"
            setTimeout(() => {
                error.classList.add("hidden")
            }, 5000);
            return;
        }
        // Update modal with user data
        document.getElementById('modal-username').textContent = username;
        document.getElementById('modal-platform-icon').textContent = selectedPlatform === 'instagram' ? 'ðŸ“¸' : 'ðŸŽµ';
        // Show modal
        document.getElementById('followersModal').classList.remove('hidden');
        document.body.classList.add('overflow-hidden');
    }

</script>

<script is:inline>
    async function openPaymentModal() {
        const orderData = JSON.parse(localStorage.getItem("orderData"));
        if (!orderData) {
            alert("Error: No se encontraron datos del pedido");
            return;
        }
        // Update payment modal with order data
        document.getElementById("payment-username").textContent =
            "@" + orderData.username;
        document.getElementById("payment-platform").textContent =
            orderData.platform === "instagram" ? "Instagram" : "TikTok";
        document.getElementById("payment-platform-icon").textContent =
            orderData.platform === "instagram" ? "ðŸ“¸" : "ðŸŽµ";
        document.getElementById("payment-followers").textContent =
            orderData.followers.toLocaleString() + " Seguidores";
        // Set price based on followers
        let basePrice = "GRATIS";
        if (orderData.followers > 400) {
            if (orderData.platform === "instagram") {
                const priceMapInsta = {
                    500: "â‚¬1.8",
                    1000: "â‚¬3.8",
                    2500: "â‚¬6.8",
                    5000: "â‚¬12.8",
                    10000: "â‚¬25.8",
                    20000: "â‚¬45.8",
                    35000: "â‚¬52.9",
                    50000: "â‚¬75.9",
                };
                basePrice = priceMapInsta[orderData.followers] || "â‚¬29.99";
            } else {
                const priceMapTiktok = {
                    500: "â‚¬2.8",
                    1000: "â‚¬5.8",
                    2500: "â‚¬8.9",
                    5000: "â‚¬12.8",
                    10000: "â‚¬38.8",
                    20000: "â‚¬74.8",
                    35000: "â‚¬110",
                    50000: "â‚¬135",
                };
                basePrice = priceMapTiktok[orderData.followers] || "â‚¬29.99";
            }
        }
        document.getElementById("payment-price").textContent = basePrice;
        document.getElementById("total-pay").textContent = basePrice;
        // Show payment modal
        document.getElementById("paymentModal").classList.remove("hidden");
        document.body.classList.add("overflow-hidden");
    }
    // FunciÃ³n para volver al modal de seguidores
    function backToFollowersModal() {
        closePaymentModal();
        document.getElementById("followersModal").classList.remove("hidden");
        document.body.classList.add("overflow-hidden"); // Ensure body overflow is handled
    }
  
    // FunciÃ³n para cerrar modal de pago
    function closePaymentModal() {
        document.getElementById("paymentModal").classList.add("hidden");
        document.body.classList.remove("overflow-hidden");
        // Reset form
        document.getElementById("payment-form").reset();
    }
</script>
